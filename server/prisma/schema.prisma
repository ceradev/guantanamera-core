generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  EMPLOYEE
}

enum OrderStatus {
  RECEIVED
  PREPARING
  READY
  DELIVERED
  CANCELLED
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  products Product[]
}

model Product {
  id         Int         @id @default(autoincrement())
  name       String      @unique
  price      Float
  active     Boolean     @default(true)
  categoryId Int
  category   Category    @relation(fields: [categoryId], references: [id])
  createdAt  DateTime    @default(now())
  orderItems OrderItem[]
  saleItems  SaleItem[]
}

model Order {
  id            Int         @id @default(autoincrement())
  customerName  String
  customerPhone String?
  pickupTime    String
  status        OrderStatus @default(RECEIVED)
  total         Float
  createdAt     DateTime    @default(now())
  items         OrderItem[]
  sales         Sale[]
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  order     Order   @relation(fields: [orderId], references: [id])
  productId Int
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float
}

model Setting {
  key       String   @id
  value     String
  type      String   @default("string") // "string", "number", "boolean", "json"
  updatedAt DateTime @updatedAt
}

model Sale {
  id             String     @id @default(uuid())
  date           DateTime
  source         SaleSource
  relatedOrderId Int? // Changed to Int to match Order.id
  totalAmount    Float
  notes          String?
  createdAt      DateTime   @default(now())

  items SaleItem[]
  order Order?     @relation(fields: [relatedOrderId], references: [id])
}

model SaleItem {
  id         String @id @default(uuid())
  saleId     String
  productId  Int // Changed to Int to match Product.id
  quantity   Int
  unitPrice  Float
  totalPrice Float

  sale    Sale    @relation(fields: [saleId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

enum SaleSource {
  ORDER
  MANUAL
}

enum ExpenseCategory {
  FOOD
  DRINKS
  SUPPLIES
  RENT
  UTILITIES
  MAINTENANCE
  OTHER
}

model Invoice {
  id          String          @id @default(uuid())
  date        DateTime
  supplier    String
  reference   String?
  totalAmount Float
  category    ExpenseCategory
  notes       String?
  createdAt   DateTime        @default(now())

  items InvoiceItem[]
}

model InvoiceItem {
  id          String @id @default(uuid())
  invoiceId   String
  description String
  quantity    Int
  unitPrice   Float
  totalPrice  Float

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}
